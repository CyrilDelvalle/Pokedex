import type { NextPage } from "next";
import Head from "next/head";
import { useEffect, useState } from "react";

import SearchBar from "./SearchBar";
import index from "./api/index";
import { IPokemon } from "./IPokemon";
import Loader from "./Loader";
import AllPokemons from "./AllPokemon";

const Home: NextPage = () => {
  const [searchQuery, setSearchQuery] = useState("");
  const [pokemons, setPokemons] = useState<IPokemon[]>([]);
  const [filteredPokemons, setFilteredPokemons] = useState<IPokemon[]>([]);

  useEffect(() => {
    const fetchData = async () => {
      const pokemons: IPokemon[] = await index();
      setPokemons(pokemons);
      setFilteredPokemons(pokemons);
    };
    fetchData().catch(console.error);
  }, []);

  useEffect(() => {
    if (searchQuery === "") {
      setFilteredPokemons(pokemons);
    } else {
      setFilteredPokemons(
        pokemons.filter((pokemon) =>
          pokemon.name.toLowerCase().startsWith(searchQuery)
        )
      );
    }
  }, [pokemons, searchQuery]);

  return (
    <div>
      <Head>
        <title>Pokedex</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main className="flex flex-col justify-center ">
        <div className="dark:bg-slate-900 px-6 py-8">
          <SearchBar
            searchQuery={searchQuery}
            setSearchQuery={setSearchQuery}
            isActivate={pokemons.length === 0}
          />
          {pokemons.length !== 0 && (
            <AllPokemons filteredPokemons={filteredPokemons} />
          )}
        </div>
        {pokemons.length === 0 && <Loader />}
      </main>

      {/* <footer className={styles.footer}></footer> */}
    </div>
  );
};

export default Home;
